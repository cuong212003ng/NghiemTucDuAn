extends ../../layout/default.pug

include ../../mixins/filterStatus.pug
include ../../mixins/search.pug
include ../../mixins/pagination.pug
include ../../mixins/formChangeMulti.pug
include ../../mixins/showalert.pug

block main
    +alertSuccess(5000)
            
    h1 Danh sách sản phẩm
    .card.mb-3 
        .card-header
            h5.card-title Bộ lọc và tìm kiếm
        .card-body
            .row
                .col-6
                    +filterStatus(filterStatus)
                .col-6 
                    +search(keyword)
                            

    .card.mb-3
        .card-header
            .row
                .col-6 
                    h5.card-title Danh sách sản phẩm
                .col-6.text-end
                    a(
                        class="btn btn-sm btn-outline-success"
                        href=`${prefixAdmin}/products/create`
                    ) + Thêm sản phẩm
        .card-body
            .row
                .col-6  
                    +formChangeMulti(`${prefixAdmin}/products/change-multi?_method=PATCH`)
                .col-6.text-end 
                    div(sort)
                        .row
                            .col-6
                                select(
                                    class="form-control"
                                    name="sort"
                                    sort-select
                                )
                                    option(value="position-asc")  Vị trí tăng dần
                                    option(value="position-desc") Vị trí giảm dần
                                    option(value="price-asc") Giá tăng dần
                                    option(value="price-desc") Giá giảm dần
                                    option(value="title-asc") Từ A đến Z
                                    option(value="title-desc") Từ Z đến A
                            .col-auto    
                                button(
                                    class="btn btn-sm btn-outline-danger"
                                    sort-clear
                                ) Clear
                        
                .table-responsive
                    table(
                        class="table table-hover table-sm"
                        checkbox-multi
                    )
                        thead 
                            tr
                                th
                                    input(type="checkbox" name="checkAll")
                                th STT
                                th Vị trí
                                th Hình ảnh
                                th Tên sản phẩm
                                th Giá
                                th Giảm giá
                                th Trạng thái
                                th Hành động
                        tbody
                            each item, index in products  
                                tr
                                    td 
                                        input(
                                            type="checkbox" 
                                            name="checkItem" 
                                            value=item._id
                                        )
                                    td #{pagination.limitItems * (pagination.currentPage - 1) + index + 1}
                                    td 
                                        input(
                                            type='number'
                                            value=item.position
                                            style='width: 50px'
                                            min='1'
                                            name='position'
                                        )
                                    td 
                                        img.img-thumbnail(src=item.thumbnail, alt=item.title width="100px" height="auto")
                                    td #{item.title}
                                    td #{item.price} $
                                    td #{item.discountPercentage} %
                                    td
                                        if item.status == 'active'
                                            a(
                                                href=`javascript:`
                                                data-status=item.status
                                                data-id=item._id
                                                button-change-status
                                                class="badge bg-success"
                                            ) Hoạt động
                                        else
                                            a(
                                                href=`javascript:`
                                                data-id=item._id
                                                data-status=item.status
                                                button-change-status
                                                class="badge bg-danger" 
                                            ) Không hoạt động
                                    td  
                                        a(
                                            href=`${prefixAdmin}/products/detail/${item._id}`
                                            class=`btn btn-secondary btn-sm margin-right: 8px`,
                                            style="margin-right: 8px"
                                            data-id=item._id
                                            button-detail
                                        ) Chi tiết    
                                        button(
                                        class=`btn btn-warning btn-sm margin-right: 8px`,
                                        style="margin-right: 8px"
                                        data-id=item._id
                                        button-edit
                                        ) Sửa    
                                        button(
                                            class=`btn btn-danger btn-sm`
                                            data-id=item._id
                                            button-delete
                                        ) Xóa


    
    .row 
        .col-6
            +pagination(pagination)
        .col-6.text-end
            a.btn.btn-primary(href=`${prefixAdmin}/products/trash`) Thùng rác

    //- Form change status nhằm thay đổi trạng thái của sản phẩm
    form(
        action=""
        method="POST" 
        id="form-change-status"
        data-path=`${prefixAdmin}/products/change-status`
    )

    form(
        action=""
        method="POST"
        id="form-delete"
        data-path=`${prefixAdmin}/products/delete`
    )

    form(
        action=""
        method="POST"
        id="form-edit"
        data-path=`${prefixAdmin}/products/edit`
    )

    script(src="/admin/js/productScripts.js") 

